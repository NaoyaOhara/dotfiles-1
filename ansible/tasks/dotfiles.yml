---
- file: path={{ dotfiles_dir | dirname }} state=directory

- git: repo={{ dotfiles_repo }} dest={{ dotfiles_dir }} accept_hostkey=yes

- command: git remote -v chdir={{ dotfiles_dir }}
  register: remote_stat
  changed_when: remote_stat.rc not in [0, 1]

- command: git remote set-url --push origin {{ dotfiles_repo_push }} chdir={{ dotfiles_dir }}
  when: remote_stat.stdout.find(dotfiles_repo_push) == -1

- command: git remote add github {{ dotfiles_repo_github }} chdir={{ dotfiles_dir }}
  when: remote_stat.stdout.find(dotfiles_repo_github }} == -1

- file: path=~/.config state=directory
- file: src={{ '/'.join([dotfiles_dir, item]) }} dest=~/{{ item }} state=link force=yes
  with_items:
    - .config/ipython
    - .config/peco
    - .config/powerline
    - .editrc
    - .gitconfig
    - .inputrc
    - .jshintrc
    - .vim
    - .zprofile
    - .zshrc

- file: path='~/Library/Application Support/Karabiner' state=directory
- copy: src=files/private.xml dest='~/Library/Application Support/Karabiner/private.xml'
