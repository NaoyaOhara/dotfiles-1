---
- command: git remote -v chdir={{ dotfiles_dir }}
  register: remote_stat
  changed_when: remote_stat.rc != 0 or remote_stat.rc != 1

- command: git remote add public {{ dotfiles_repo_github }} chdir={{ dotfiles_dir }}
  when: remote_stat.stdout.find(dotfiles_repo_public) == -1

- file: path={{ home_dir }}/.config state=directory

- name: make dotfiles symlink
  file: src={{ '/'.join([dotfiles_dir, item]) }} dest={{ home_dir }}/{{ item }} state=link force=yes
  with_items:
    - .config/gocode
    - .config/ipython
    - .config/peco
    - .config/powerline
    - .config/ranger
    - .editrc
    - .gitconfig
    - .grcat
    - .inputrc
    - .jshintrc
    - .myclirc
    - .proverc
    - .ptconfig.toml
    - .tern-project
    - .tmux
    - .tmux.conf
    - .vim
    - .vimrc_first.vim
    - .zlogin
    - .zlogout
    - .zprezto
    - .zpreztorc
    - .zprofile
    - .zshenv
    - .zshrc

- name: symlink dircolors
  file: >-
    src={{ '/'.join([dotfiles_dir, 'submodules/dircolors-solarized/dircolors.ansi-light']) }}
    dest={{ home_dir }}/.dir_colors
    state=link
    force=yes

- file: path='{{ home_dir }}/Library/Application Support/Karabiner' state=directory
  when: ansible_system == 'Darwin'
- copy: src=private.xml dest='{{ home_dir }}/Library/Application Support/Karabiner/private.xml'
  when: ansible_system == 'Darwin'

- file: path={{ home_dir }}/.ssh/config state=touch
  changed_when: false
- lineinfile: dest={{ home_dir }}/.ssh/config line='Host *' state=present
- lineinfile: dest={{ home_dir }}/.ssh/config line='  ServerAliveInterval 120' insertafter='^Host \*$'
