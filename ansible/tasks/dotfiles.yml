---
- file: path={{ dotfiles_dir | dirname }} state=directory

- command: git remote -v chdir={{ dotfiles_dir }}
  register: remote_stat
  changed_when: remote_stat.rc not in [0, 1]

- command: git remote add github {{ dotfiles_repo_github }} chdir={{ dotfiles_dir }}
  when: remote_stat.stdout.find(dotfiles_repo_github) == -1

- file: path={{ home_dir }}/.config state=directory
- file: src={{ '/'.join([dotfiles_dir, item]) }} dest={{ home_dir }}/{{ item }} state=link force=yes
  with_items:
    - .config/ipython
    - .config/peco
    - .config/powerline
    - .editrc
    - .gitconfig
    - .inputrc
    - .jshintrc
    - .proverc
    - .vim
    - .zshenv
    - .zprofile
    - .zshrc
    - .myclirc
    - .bash_profile

- file: src={{ '/'.join([dotfiles_dir, item]) }} dest=~/{{ item }} state=link force=yes
  with_items:
    - .grcat

- file: path='{{ home_dir }}/Library/Application Support/Karabiner' state=directory
  when: ansible_system == 'Darwin'
- copy: src=private.xml dest='{{ home_dir }}/Library/Application Support/Karabiner/private.xml'
  when: ansible_system == 'Darwin'

- file: path={{ home_dir }}/.ssh/config state=touch
  changed_when: false
- lineinfile: dest={{ home_dir }}/.ssh/config line='Host *' state=present
- lineinfile: dest={{ home_dir }}/.ssh/config line='  ServerAliveInterval 120' insertafter='^Host \*$'
